## 每日打卡网站企划书

---

### 一、项目概述
**项目名称**：DailyCheck（每日打卡）  
**核心目标**：打造一款轻量级、高视觉反馈的每日打卡工具，通过**颜色状态可视化**（绿/黄/红）强化用户习惯养成，同时满足多端适配、数据安全与可扩展性需求。  
**核心价值**：  
- ✅ **极简操作**：所有交互通过底部抽屉完成，降低学习成本  
- ✅ **强视觉反馈**：日历颜色动态映射打卡状态（绿=成功/黄=补签/红=错过）  
- ✅ **企业级安全**：伪删除、黑名单、权限控制保障数据安全  
- ✅ **深度埋点**：不仅记录操作，更分析用户行为路径  

---

### 二、详细需求分析
#### （1）核心功能需求
| 模块                | 功能描述                                                                 | 优先级 |
|---------------------|--------------------------------------------------------------------------|--------|
| **用户系统**        | - 邮箱注册（需邮箱验证）- 单点登录（SSO）：支持微信/Google账号绑定- 用户黑名单：管理员可冻结账号，记录冻结原因及时间- 伪删除：`is_deleted`字段+`deleted_at`，保留操作日志 | P0     |
| **打卡核心逻辑**    | - 添加打卡计划：设置计划名称、开始日期- **每日打卡**：仅可打卡当日（当前日期），上传图片（≤3张）+备注- **状态映射**：  ✅ 成功：当日日历背景绿  ⚠️ 补签（过期）：背景黄（需触发补签弹窗）  ❌ 错过：背景红（不可再打卡） | P0     |
| **UI/UX要求**       | - 所有弹窗：**底部抽屉式**（如添加计划页、补签详情页）- 日历：**国内样式**（周一为第一周，非周日）- 暗夜模式：全局切换，支持自动/手动- 多端适配：响应式布局（手机/平板/桌面） | P0     |
| **数据与埋点**      | - **埋点系统**：记录操作路径（如“用户从首页→添加计划→完成打卡”），用于分析用户流失点- 伪删除日志：记录删除者、时间、原因 | P1     |

> ✨ **关键创新点**：  
> - **补签逻辑**：过期卡片可补打（背景黄），但需在抽屉中明确提示“补签需额外操作”，避免滥用  
> - **状态驱动UI**：日历背景色直接关联数据库状态（`status=1=绿, status=2=黄, status=0=红`）

---

### 三、技术架构设计
#### （1）技术栈选型
| 层面       | 选型                      | 选型理由                                                                 |
|------------|---------------------------|--------------------------------------------------------------------------|
| **前端**   | Vue 3 + TypeScript + Pinia | 类型安全，状态管理高效；Pinia替代Vuex，更轻量                             |
|            | Axios                     | 标准HTTP库，支持拦截器（用于JWT自动注入）                                |
|            | Sass                      | 模块化CSS，支持暗夜模式变量切换                                          |
|            | Element Plus              | **核心UI库**：提供`el-calendar`（可配置周一为第一周）+ `el-drawer`（底部抽屉） |
| **后端**   | ASP.NET Core 7            | 高性能API框架，内置JWT支持，与MySQL无缝集成                              |
|            | MySQL 8.0                 | 关系型数据库，支持`is_deleted`伪删除设计                                |
| **数据**   | 埋点系统：自定义Log + 分析服务 | 通过中间件记录`user_id`、`action`、`timestamp`、`path`，存入`user_activity`表 |

#### （2）数据库关键表设计
```sql
-- 用户表
CREATE TABLE users (
  id INT PRIMARY KEY AUTO_INCREMENT,
  email VARCHAR(255) UNIQUE NOT NULL,
  password_hash VARCHAR(255) NOT NULL, -- bcrypt加密
  is_deleted BOOLEAN DEFAULT false,
  deleted_at DATETIME,
  role ENUM('user','admin') DEFAULT 'user'
);

-- 打卡计划表
CREATE TABLE checkin_plans (
  id INT PRIMARY KEY AUTO_INCREMENT,
  user_id INT NOT NULL,
  title VARCHAR(255) NOT NULL,
  start_date DATE NOT NULL
);

-- 打卡记录表
CREATE TABLE checkins (
  id INT PRIMARY KEY AUTO_INCREMENT,
  plan_id INT NOT NULL,
  check_date DATE NOT NULL, -- 仅存储日期（不存时间）
  images JSON, -- 存储图片URL数组
  note TEXT,
  status TINYINT NOT NULL, -- 0=错过, 1=成功, 2=补签
  created_at DATETIME DEFAULT NOW()
);
```

> 💡 **伪删除实现**：  
> `UPDATE users SET is_deleted=true, deleted_at=NOW() WHERE id=123;`  
> 查询时自动过滤：`WHERE is_deleted = false`

---

### 四、UI/UX设计要点
#### （1）关键页面交互流程
| 页面                | 交互逻辑                                                                 |
|---------------------|--------------------------------------------------------------------------|
| **首页（日历）**    | - 日历默认展示当前月，**周一为第一列**- 每日格子：背景色根据`checkins.status`动态渲染（绿/黄/红）- 点击格子→弹出**底部抽屉**（签到详情） |
| **添加打卡计划**    | - 点击“+”按钮→**底部抽屉**（Element Plus `el-drawer`）- 输入框：计划标题、开始日期（默认今日）- 提交后自动创建打卡计划 |
| **打卡/补签**       | - **当日打卡**：点击日历格子→抽屉显示“今日打卡”（可上传图片+备注）- **补签**：点击已过期格子（红）→抽屉提示“补签需操作”，选择日期后上传图片 |
| **暗夜模式**        | - 顶部切换按钮（日/夜图标）- 通过CSS变量切换：`--bg-color: #ffffff;` → `--bg-color: #121212;` |

#### （2）日历样式实现（国内周一）
```vue
<el-calendar :first-day-of-week="1"> <!-- 1代表周一 -->
  <template #date-cell="{ data }">
    <div :class="getCalendarColor(data.date)">
      {{ data.day.split('-')[2] }}
    </div>
  </template>
</el-calendar>
```

> 🌟 **颜色计算逻辑**（`getCalendarColor`）：
> ```ts
> function getCalendarColor(date: Date): string {
>   const status = checkinStatusMap[date.toISOString().split('T')[0]];
>   if (status === 1) return 'bg-green-100'; // 成功
>   if (status === 2) return 'bg-yellow-100'; // 补签
>   return 'bg-red-100'; // 错过
> }
> ```

---

### 五、开发计划（总周期 10 周）
| 阶段         | 时长   | 交付物                              | 关键里程碑                          |
|--------------|--------|-------------------------------------|-------------------------------------|
| **基础搭建** | 2周    | 前后端框架、用户注册/登录、数据库    | ✅ 邮箱注册+JWT认证通过              |
| **核心功能** | 4周    | 打卡计划管理、日历状态渲染、底部抽屉 | ✅ 日历状态色映射（绿/黄/红）实现   |
| **高级功能** | 2周    | 伪删除、黑名单、埋点系统、暗夜模式   | ✅ 埋点数据可分析用户路径           |
| **测试上线** | 2周    | 多端适配测试、安全审计、部署上线     | ✅ 通过iOS/Android/桌面端兼容性测试  |

> ⏱️ **关键时间点**：  
> - 第3周：完成日历状态可视化（核心MVP）  
> - 第6周：埋点系统上线（分析打卡流失点）  
> - 第10周：全平台交付

---

### 六、风险与应对
| 风险                          | 应对方案                                                                 |
|-------------------------------|--------------------------------------------------------------------------|
| **补签功能被滥用**            | 限制：每日仅可补签1次，补签需在过期后24小时内操作（需后端校验）            |
| **国内日历样式兼容问题**      | 使用Element Plus `first-day-of-week="1"` + 本地化配置（避免第三方库依赖） |
| **埋点数据量过大**            | 采用分页+抽样：仅记录关键路径（如“添加计划→打卡”），避免日志爆炸           |
| **暗夜模式兼容性**            | 用CSS变量+`prefers-color-scheme`媒体查询，确保所有组件适配                |

---

### 七、附录：待确认事项
1. **补签收费策略**：  
   > *当前方案：免费补签（需在企划书注明“需后续评估收费”）*  
   > **建议**：初期免费，后期通过“补签次数”付费（如5次/月）提升收益。
2. **SSO平台**：  
   > *需确认是否集成微信/Google/Apple ID*  
   > **建议**：优先集成微信（国内用户覆盖高）。
3. **图片存储**：  
   > *建议静态文件集成到后端api里，避免MySQL存储大文件。*

---

> **企划书总结**：  
> 本方案以**状态可视化**为核心，通过**底部抽屉+颜色映射**降低用户认知负担，技术栈选型兼顾开发效率与企业级需求（伪删除/埋点/权限）。  
> **下一步行动**：  
> 1. 确认补签收费策略  
> 2. 选定SSO平台（建议微信）  
> 3. 启动基础搭建（2周内交付框架）  

> 📌 **交付物**：完整API文档、UI设计稿（Figma）、数据库ER图  
> **团队建议**：前端2人（Vue3+TS）、后端1人（ASP.NET Core）、测试1人（含自动化）  

> **“让习惯可视化，让坚持更简单”**  
> —— DailyCheck 企划书 · 2026年1月